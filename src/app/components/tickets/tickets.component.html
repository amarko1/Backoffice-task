<app-navbar></app-navbar>
<app-ticket-details-modal></app-ticket-details-modal>
<app-filter-modal
  [filters]="filters"
  [showModal]="isFiltersModalOpen"
  (applyFilters)="applyFilters($event)"
  (closeFilters)="closeFiltersModal()">
</app-filter-modal>
<div class="filter-container">
  <form [formGroup]="filterForm" (ngSubmit)="onFilter()">

    <div id="filters">
      <a (click)="openFiltersModal()"> {{ 'filterLabel' | translate }}</a>
    </div>

    <div *ngIf="filterForm.contains('playerId')">
      <label>{{ 'player' | translate }}:</label>
      <ng-select
        formControlName="playerId"
        [editableSearchTerm]="true"
        placeholder="{{'allPlayers' | translate}}"
        [clearable]="true"
      >
        <ng-option *ngFor="let player of players" [value]="player.id">
          {{ player.firstName }} {{ player.lastName }}
        </ng-option>
      </ng-select>
    </div>

    <div *ngIf="filterForm.contains('status')">
      <label>{{ 'status' | translate }}: </label>
      <ng-select
        formControlName="status"
        [editableSearchTerm]="true"
        placeholder="{{'allStatuses' | translate}}"
      >
        <ng-option value="Won">Won</ng-option>
        <ng-option value="Lost">Lost</ng-option>
        <ng-option value="Created">Created</ng-option>
      </ng-select>
    </div>

    <div *ngIf="filterForm.contains('startDate')">
      <label>{{ 'startDate' | translate }}:</label>
      <input type="date" formControlName="startDate" name="startDate">
    </div>

    <div *ngIf="filterForm.contains('endDate')">
      <label>{{ 'endDate' | translate }}:</label>
      <input type="date" formControlName="endDate" name="endDate">
    </div>

    <div class="buttons">
      <button type="submit">{{ 'filter' | translate }}</button>
      <button type="button" (click)="reset()">{{ 'reset' | translate }}</button>
    </div>

    <!--<div id="filterButton">
      <button class="open-filters-btn" (click)="openFiltersModal()">Open Filters</button>
    </div>-->

  </form>
</div>

<app-loader *ngIf="isLoading"></app-loader>

<div *ngIf="!isLoading" class="centered-table-container">
  <table>
    <thead>
    <tr>
      <th>{{ 'player' | translate }}</th>
      <th>{{ 'bets' | translate }}</th>
      <th>{{ 'payInAmount' | translate }}</th>
      <th>{{ 'payOutAmount' | translate }}</th>
      <th>{{ 'currency' | translate }}</th>
      <th>{{ 'status' | translate }}</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let ticket of filteredTickets">
      <td>{{ getPlayerName(ticket.playerId) }}</td>
      <td>
        <ul>
          <li *ngFor="let bet of ticket.bets">
            {{ bet.participants.join(' vs ') }}: {{ bet.status }}
            at: {{ bet.odds | number:'1.2-2' }} {{ 'odds' | translate }}
          </li>
        </ul>
      </td>
      <td>{{ ticket.payInAmount }}</td>
      <td>{{ ticket.payOutAmount }}</td>
      <td>{{ ticket.currency }}</td>
      <td>
        <h4 [ngClass]="getStatusClass(ticket?.status)">{{ ticket?.status }}</h4>
      </td>
      <td class="centered-content">
          <button (click)="openTransactionDetails(ticket)">{{ 'details' | translate }}</button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

